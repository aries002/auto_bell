<h2>Playlist</h2>
<hr />
<form method="post" action="">
    <div class="mb-3">
        <div id="playlist"></div>
    </div>
    <div class="mb-3">
        <input type="button" id="simpan" value="Simpan" class="btn btn-primary">
    </div>
</form>

<script>
    let listcode = [];
    $(document).ready(function () {
        let jadwal = data["JADWAL"];
        for (hari in jadwal) {
            for (jam in jadwal[hari]) {
                if (!listcode.includes(jadwal[hari][jam])) {
                    listcode.push(jadwal[hari][jam]);
                    let kode = jadwal[hari][jam];
                    $("#playlist").append(`<div class="row mb-2 listcode">
                        <b class="kodeplaylist">${kode}</b>
                        <div id="${kode}" style="margin-left:15px;"></div>
                    </div>
                    <div>
                        <button type="button" class="btn btn-success btn-sm" onclick="addlist('${kode}',1)">
                            <i class="bi bi-plus"></i></button>
                        <button type="button" class="btn btn-danger btn-sm" onclick="addlist('${kode}',-1)">
                            <i class="bi bi-dash"></i></button>
                    </div>`);

                    let listing = data["PLAYLIST"];
                    for (list in listing[kode]) {
                        addlist(kode, 1, listing[kode][list]);
                    }
                }
            }
        }

        $("#simpan").click(function () {
            let playlist = {};
            let kodeplaylist = document.getElementsByClassName("kodeplaylist");
            for (let i = 0; i < kodeplaylist.length; i++) {
                let nokode = kodeplaylist[i].innerHTML;
                let audio = document.getElementsByClassName("kdval" + nokode);
                // console.log(audio);
                playlist[nokode] = [];
                for (let j = 0; j < audio.length; j++) {
                    playlist[nokode].push(audio[j].value);
                }
            }

            // console.log(playlist);

            $.ajax({
                type: "POST",
                url: window.location.pathname,
                data: { "playlist": JSON.stringify(playlist) },
                success: function (data) {
                    // console.log(data);
                    makeToast("Data disimpan");
                }
            });
        });
    });


    function addlist(id = "", add = 1, value = "") {
        if (add == 1) {
            $("#" + id).append(`<div class="row mb-2 nval${id}">
                    <input type="text" class="form-control kdval${id}" value="${value}"/>
                </div>`);
        } else {
            let nval = document.getElementsByClassName("nval" + id);
            nval[nval.length - 1].parentNode.removeChild(nval[nval.length - 1]);
        }
    }
</script>